var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,o=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&i(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&i(e,a,t[a]);return e},u=(e,t,a)=>new Promise((l,n)=>{var r=e=>{try{o(a.next(e))}catch(t){n(t)}},i=e=>{try{o(a.throw(e))}catch(t){n(t)}},o=e=>e.done?l(e.value):Promise.resolve(e.value).then(r,i);o((a=a.apply(e,t)).next())});import{u as s,_ as p,a as d,E as m,A as c}from"./useTableColumns-CBjkK4nZ.js";import{_ as v}from"./index-CkAITQ7k.js";import{d as h,s as f,aI as j,a as y,r as b,c as g,o as x,y as k,e as _,f as w,z as C,u as O,H as A,C as B,I as L,k as T,J as P,l as D,m as E,aD as M,n as I,a8 as R,O as $}from"./index-Bt2F3fsx.js";import{u as S}from"./useAuth-CGa0IbXr.js";import{_ as U}from"./menu-dialog.vue_vue_type_script_setup_true_lang-XJA6_R6s.js";import{E as V}from"./index-B2c65Y4B.js";import{E as z}from"./index-BmjwfTQ1.js";import{a as H}from"./index-BP3apele.js";import{_ as W}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-DKTFZ-Eh.js";import"./index-Bg32yf_K.js";import"./aria-DZx3bhbH.js";import"./index-DKc9HdpN.js";import"./index-CSaJqGkQ.js";import"./index-BaMjeaFB.js";import"./_baseClone-DwHx1_gd.js";import"./isArrayLikeObject-C5sk-fBD.js";import"./castArray-DaEAnbfi.js";import"./index-BRyj0R8Q.js";import"./index-B1zM4rP2.js";import"./index-CubyMTZl.js";import"./index-V01GqruJ.js";import"./refs-D0ZxbSzV.js";import"./index-Cr15QHDQ.js";import"./index-9JDm7yr7.js";import"./index-a6buLyQo.js";import"./token-DWNpOE8r.js";import"./index-BhU1Qnvd.js";import"./index-CuKF1hWI.js";import"./vnode-D7OjJs6e.js";import"./cloneDeep-4Ubnn_UQ.js";import"./index-DVtIDzx4.js";import"./validator-DwGrSO6l.js";import"./index-3ycmufMx.js";import"./index-yYjo3Bby.js";import"./use-dialog-C_JhW6YK.js";const F={class:"menu-page art-full-height"};var G;const J=W(h((G=o({},{name:"Menus"}),t(G,a({__name:"index",setup(e){const{hasAuth:t}=S(),{menuList:a}=f(j()),l=y(!1),n=y(!1),r=y(),i=y(!1),h=y("menu"),W=y(null),G=y(!1),J={name:"",route:""},K=b(o({},J)),Q=b(o({},J)),Z=g(()=>[{label:"菜单名称",key:"name",type:"input",props:{clearable:!0}},{label:"路由地址",key:"route",type:"input",props:{clearable:!0}}]),q=e=>{var t,a,l,n,r;return(null==(t=e.meta)?void 0:t.isAuthButton)?"danger":(null==(a=e.children)?void 0:a.length)?"info":(null==(l=e.meta)?void 0:l.link)&&(null==(n=e.meta)?void 0:n.isIframe)?"success":e.path?"primary":(null==(r=e.meta)?void 0:r.link)?"warning":"info"},{columnChecks:N,columns:X}=s(()=>[{prop:"meta.title",label:"菜单名称",minWidth:120,formatter:e=>{var t;return M(null==(t=e.meta)?void 0:t.title)}},{prop:"type",label:"菜单类型",formatter:e=>R(z,{type:q(e)},()=>(e=>{var t,a,l,n,r;return(null==(t=e.meta)?void 0:t.isAuthButton)?"按钮":(null==(a=e.children)?void 0:a.length)?"目录":(null==(l=e.meta)?void 0:l.link)&&(null==(n=e.meta)?void 0:n.isIframe)?"内嵌":e.path?"菜单":(null==(r=e.meta)?void 0:r.link)?"外链":"未知"})(e))},{prop:"path",label:"路由",formatter:e=>{var t,a;return(null==(t=e.meta)?void 0:t.isAuthButton)?"":(null==(a=e.meta)?void 0:a.link)||e.path||""}},{prop:"meta.authList",label:"权限标识",formatter:e=>{var t,a,l,n;return(null==(t=e.meta)?void 0:t.isAuthButton)?(null==(a=e.meta)?void 0:a.authMark)||"":(null==(n=null==(l=e.meta)?void 0:l.authList)?void 0:n.length)?`${e.meta.authList.length} 个权限标识`:""}},{prop:"date",label:"编辑时间",formatter:()=>"2022-3-12 12:00:00"},{prop:"status",label:"状态",formatter:()=>R(z,{type:"success"},()=>"启用")},{prop:"operation",label:"操作",width:180,align:"right",formatter:e=>{var t;const a={style:"text-align: right"};return(null==(t=e.meta)?void 0:t.isAuthButton)?R("div",a,[R(c,{type:"edit",onClick:()=>de(e)}),R(c,{type:"delete",onClick:()=>ve()})]):R("div",a,[R(c,{type:"add",onClick:()=>se(),title:"新增权限"}),R(c,{type:"edit",onClick:()=>pe(e)}),R(c,{type:"delete",onClick:()=>ce()})])}}]),Y=y([]),ee=()=>{Object.assign(K,o({},J)),Object.assign(Q,o({},J)),le()},te=()=>{Object.assign(Q,o({},K)),le()},ae=()=>{le()},le=()=>{l.value=!0,setTimeout(()=>{Y.value=a.value,l.value=!1},500)},ne=e=>{if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return new Date(e);if(Array.isArray(e))return e.map(e=>ne(e));const t={};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=ne(e[a]));return t},re=e=>e.map(e=>{var t,a,l,n;const r=ne(e);if((null==(t=r.children)?void 0:t.length)&&(r.children=re(r.children)),null==(l=null==(a=e.meta)?void 0:a.authList)?void 0:l.length){const t=e.meta.authList.map(t=>({path:`${e.path}_auth_${t.authMark}`,name:`${String(e.name)}_auth_${t.authMark}`,meta:{title:t.title,authMark:t.authMark,isAuthButton:!0,parentPath:e.path}}));r.children=(null==(n=r.children)?void 0:n.length)?[...r.children,...t]:t}return r}),ie=e=>{var t,a,l,n;const r=[];for(const i of e){const e=(null==(t=Q.name)?void 0:t.toLowerCase().trim())||"",o=(null==(a=Q.route)?void 0:a.toLowerCase().trim())||"",u=M((null==(l=i.meta)?void 0:l.title)||"").toLowerCase(),s=(i.path||"").toLowerCase(),p=!e||u.includes(e),d=!o||s.includes(o);if(null==(n=i.children)?void 0:n.length){const e=ie(i.children);if(e.length>0){const t=ne(i);t.children=e,r.push(t);continue}}p&&d&&r.push(ne(i))}return r},oe=g(()=>{const e=ie(Y.value);return re(e)}),ue=()=>{h.value="menu",W.value=null,G.value=!0,i.value=!0},se=()=>{h.value="menu",W.value=null,G.value=!1,i.value=!0},pe=e=>{h.value="menu",W.value=e,G.value=!0,i.value=!0},de=e=>{var t,a;h.value="button",W.value={title:null==(t=e.meta)?void 0:t.title,authMark:null==(a=e.meta)?void 0:a.authMark},G.value=!1,i.value=!0},me=e=>{le()},ce=()=>u(null,null,function*(){try{yield H.confirm("确定要删除该菜单吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),$.success("删除成功"),le()}catch(e){"cancel"!==e&&$.error("删除失败")}}),ve=()=>u(null,null,function*(){try{yield H.confirm("确定要删除该权限吗？删除后无法恢复","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),$.success("删除成功"),le()}catch(e){"cancel"!==e&&$.error("删除失败")}}),he=()=>{n.value=!n.value,I(()=>{var e;if((null==(e=r.value)?void 0:e.elTableRef)&&oe.value){const e=t=>{t.forEach(t=>{var a;(null==(a=t.children)?void 0:a.length)&&(r.value.elTableRef.toggleRowExpansion(t,n.value),e(t.children))})};e(oe.value)}})};return x(()=>{le()}),(e,a)=>{const o=v,u=V,s=p,c=d,f=m,j=k("auth"),y=k("ripple");return w(),_("div",F,[C(o,{modelValue:O(K),"onUpdate:modelValue":a[0]||(a[0]=e=>A(K)?K.value=e:null),items:O(Z),showExpand:!1,onReset:ee,onSearch:te},null,8,["modelValue","items"]),C(f,{class:"art-table-card",shadow:"never"},{default:B(()=>[C(s,{showZebra:!1,loading:O(l),columns:O(N),"onUpdate:columns":a[1]||(a[1]=e=>A(N)?N.value=e:null),onRefresh:ae},{left:B(()=>[L((w(),P(u,{onClick:ue},{default:B(()=>[...a[3]||(a[3]=[D(" 添加菜单 ",-1)])]),_:1})),[[j,"add"],[y]]),L((w(),P(u,{onClick:he},{default:B(()=>[D(E(O(n)?"收起":"展开"),1)]),_:1})),[[y]]),O(t)("add")?L((w(),P(u,{key:0,onClick:ue},{default:B(()=>[...a[4]||(a[4]=[D(" 添加菜单 ",-1)])]),_:1})),[[y]]):T("",!0)]),_:1},8,["loading","columns"]),C(c,{ref_key:"tableRef",ref:r,rowKey:"path",loading:O(l),columns:O(X),data:O(oe),stripe:!1,"tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":!1},null,8,["loading","columns","data"]),C(U,{visible:O(i),"onUpdate:visible":a[2]||(a[2]=e=>A(i)?i.value=e:null),type:O(h),editData:O(W),lockType:O(G),onSubmit:me},null,8,["visible","type","editData","lockType"])]),_:1})])}}})))),[["__scopeId","data-v-f82d9c8d"]]);export{J as default};
