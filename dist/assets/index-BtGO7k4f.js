var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,u=(e,t)=>{for(var n in t||(t={}))r.call(t,n)&&a(e,n,t[n]);if(o)for(var n of o(t))s.call(t,n)&&a(e,n,t[n]);return e},c=(e,o)=>t(e,n(o));import{f as d}from"./aria-DZx3bhbH.js";import{o as l,b as i,a as f,bs as p,U as v,_ as m,d as E,j as y,a5 as b,u as w,ag as h,n as L,a9 as T,a6 as P,a0 as g,ai as O,J as j,f as k,aA as F,ao as R}from"./index-yFpGTzsr.js";const S="focus-trap.focus-after-trapped",_="focus-trap.focus-after-released",K={cancelable:!0,bubbles:!1},N={cancelable:!0,bubbles:!1},I="focusAfterTrapped",x="focusAfterReleased",A=Symbol("elFocusTrap"),C=f(),D=f(0),q=f(0);let B=0;const U=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},$=(e,t)=>{for(const n of e)if(!H(n,t))return n},H=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},M=(e,t)=>{if(e){const n=document.activeElement;d(e,{preventScroll:!0}),q.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function W(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const J=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=W(e,t),e.unshift(t)},remove:t=>{var n,o;e=W(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),z=()=>{C.value="pointer",D.value=window.performance.now()},G=()=>{C.value="keyboard",D.value=window.performance.now()},Q=e=>new CustomEvent("focus-trap.focusout-prevented",c(u({},N),{detail:e}));let V=[];const X=e=>{e.code===v.esc&&V.forEach(t=>t(e))};var Y=m(E({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[I,x,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const n=f();let o,r;const{focusReason:s}=(l(()=>{0===B&&(document.addEventListener("mousedown",z),document.addEventListener("touchstart",z),document.addEventListener("keydown",G)),B++}),i(()=>{B--,B<=0&&(document.removeEventListener("mousedown",z),document.removeEventListener("touchstart",z),document.removeEventListener("keydown",G))}),{focusReason:C,lastUserFocusTimestamp:D,lastAutomatedFocusTimestamp:q});var a;a=n=>{e.trapped&&!d.paused&&t("release-requested",n)},l(()=>{0===V.length&&document.addEventListener("keydown",X),p&&V.push(a)}),i(()=>{V=V.filter(e=>e!==a),0===V.length&&p&&document.removeEventListener("keydown",X)});const d={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},m=n=>{if(!e.loop&&!e.trapped)return;if(d.paused)return;const{code:o,altKey:r,ctrlKey:a,metaKey:u,currentTarget:c,shiftKey:l}=n,{loop:i}=e,f=o===v.tab&&!r&&!a&&!u,p=document.activeElement;if(f&&p){const e=c,[o,r]=(e=>{const t=U(e);return[$(t,e),$(t.reverse(),e)]})(e);if(o&&r)if(l||p!==r){if(l&&[o,e].includes(p)){const e=Q({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||(n.preventDefault(),i&&M(r,!0))}}else{const e=Q({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||(n.preventDefault(),i&&M(o,!0))}else if(p===e){const e=Q({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||n.preventDefault()}}};P(A,{focusTrapRef:n,onKeydown:m}),b(()=>e.focusTrapEl,e=>{e&&(n.value=e)},{immediate:!0}),b([n],([e],[t])=>{e&&(e.addEventListener("keydown",m),e.addEventListener("focusin",g),e.addEventListener("focusout",O)),t&&(t.removeEventListener("keydown",m),t.removeEventListener("focusin",g),t.removeEventListener("focusout",O))});const E=e=>{t(I,e)},y=e=>t(x,e),g=s=>{const a=w(n);if(!a)return;const u=s.target,c=s.relatedTarget,l=u&&a.contains(u);if(!e.trapped){c&&a.contains(c)||(o=c)}l&&t("focusin",s),d.paused||e.trapped&&(l?r=u:M(r,!0))},O=o=>{const a=w(n);if(!d.paused&&a)if(e.trapped){const n=o.relatedTarget;h(n)||a.contains(n)||setTimeout(()=>{if(!d.paused&&e.trapped){const e=Q({focusReason:s.value});t("focusout-prevented",e),e.defaultPrevented||M(r,!0)}},0)}else{const e=o.target;e&&a.contains(e)||t("focusout",o)}};function j(){return t=this,r=null,s=function*(){yield L();const t=w(n);if(t){J.push(d);const n=t.contains(document.activeElement)?o:document.activeElement;if(o=n,!t.contains(n)){const o=new Event(S,K);t.addEventListener(S,E),t.dispatchEvent(o),o.defaultPrevented||L(()=>{let o=e.focusStartEl;T(o)||(M(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(M(o,t),document.activeElement!==n)return})(U(t),!0),document.activeElement!==n&&"container"!==o||M(t)})}}},new Promise((e,n)=>{var o=e=>{try{u(s.next(e))}catch(t){n(t)}},a=e=>{try{u(s.throw(e))}catch(t){n(t)}},u=t=>t.done?e(t.value):Promise.resolve(t.value).then(o,a);u((s=s.apply(t,r)).next())});var t,r,s}function k(){const e=w(n);if(e){e.removeEventListener(S,E);const t=new CustomEvent(_,c(u({},K),{detail:{focusReason:s.value}}));e.addEventListener(_,y),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=s.value&&D.value>q.value&&!e.contains(document.activeElement)||M(null!=o?o:document.body),e.removeEventListener(_,y),J.remove(d),o=null,r=null}}return l(()=>{e.trapped&&j(),b(()=>e.trapped,e=>{e?j():k()})}),i(()=>{e.trapped&&k(),n.value&&(n.value.removeEventListener("keydown",m),n.value.removeEventListener("focusin",g),n.value.removeEventListener("focusout",O),n.value=void 0)}),{onKeydown:m}}}),[["render",function(e,t,n,o,r,s){return y(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","focus-trap.vue"]]);const Z=g({to:{type:O([String,Object]),required:!0},disabled:Boolean});const ee=R(m(E({__name:"teleport",props:Z,setup:e=>(e,t)=>e.disabled?y(e.$slots,"default",{key:0}):(k(),j(F,{key:1,to:e.to},[y(e.$slots,"default")],8,["to"]))}),[["__file","teleport.vue"]]));export{Y as E,A as F,ee as a,Z as t};
