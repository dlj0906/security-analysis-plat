var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,u=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&l(e,a,t[a]);if(n)for(var a of n(t))r.call(t,a)&&l(e,a,t[a]);return e},s=(e,n)=>t(e,a(n));import{a0 as i,ai as f,ae as c,_ as d,d as v,c as p,ay as m,a as g,o as h,a5 as x,b,c$ as y,e as $,f as w,j as M,g as I,a4 as A,ao as z,A as S,q as k,s as B,k as j,u as E,z as O,C as _,h as P}from"./index-yFpGTzsr.js";import{_ as N}from"./_plugin-vue_export-helper-BCo6x5W8.js";const C=i({zIndex:{type:Number,default:9},rotate:{type:Number,default:-22},width:Number,height:Number,image:String,content:{type:f([String,Array]),default:"Element Plus"},font:{type:f(Object)},gap:{type:f(Array),default:()=>[100,100]},offset:{type:f(Array)}});const T={left:[0,.5],start:[0,.5],center:[.5,0],right:[1,-.5],end:[1,-.5]};function W(e,t,a=1){const n=document.createElement("canvas"),o=n.getContext("2d"),r=e*a,l=t*a;return n.setAttribute("width",`${r}px`),n.setAttribute("height",`${l}px`),o.save(),[o,n,r,l]}function D(){return function(e,t,a,n,o,r,l,u,s){const[i,f,d,v]=W(n,o,a);if(e instanceof HTMLImageElement)i.drawImage(e,0,0,d,v);else{const{color:t,fontSize:n,fontStyle:l,fontWeight:u,fontFamily:f,textAlign:v,textBaseline:p}=r,m=Number(n)*a;i.font=`${l} normal ${u} ${m}px/${o}px ${f}`,i.fillStyle=t,i.textAlign=v,i.textBaseline=p;const g=c(e)?e:[e];null==g||g.forEach((e,t)=>{const[n,o]=T[v];i.fillText(null!=e?e:"",d*n+s*o,t*(m+3*a))})}const p=Math.PI/180*Number(t),m=Math.max(n,o),[g,h,x]=W(m,m,a);g.translate(x/2,x/2),g.rotate(p),d>0&&v>0&&g.drawImage(f,-d/2,-v/2);let b=0,y=0,$=0,w=0;const M=d/2,I=v/2;[[0-M,0-I],[0+M,0-I],[0+M,0+I],[0-M,0+I]].forEach(([e,t])=>{const[a,n]=function(e,t){return[e*Math.cos(p)-t*Math.sin(p),e*Math.sin(p)+t*Math.cos(p)]}(e,t);b=Math.min(b,a),y=Math.max(y,a),$=Math.min($,n),w=Math.max(w,n)});const A=b+x/2,z=$+x/2,S=y-b,k=w-$,B=l*a,j=u*a,E=2*(S+B),O=k+j,[_,P]=W(E,O);function N(e=0,t=0){_.drawImage(h,A,z,S,k,e,t,S,k)}return N(),N(S+B,-k/2-j/2),N(S+B,+k/2+j/2),[P.toDataURL(),E/a,O/a]}}const L=v({name:"ElWatermark"});const R=z(d(v(s(u({},L),{props:C,setup(e){const t=e,a={position:"relative"},n=p(()=>{var e,a;return null!=(a=null==(e=t.font)?void 0:e.color)?a:"rgba(0,0,0,.15)"}),o=p(()=>{var e,a;return null!=(a=null==(e=t.font)?void 0:e.fontSize)?a:16}),r=p(()=>{var e,a;return null!=(a=null==(e=t.font)?void 0:e.fontWeight)?a:"normal"}),l=p(()=>{var e,a;return null!=(a=null==(e=t.font)?void 0:e.fontStyle)?a:"normal"}),i=p(()=>{var e,a;return null!=(a=null==(e=t.font)?void 0:e.fontFamily)?a:"sans-serif"}),f=p(()=>{var e,a;return null!=(a=null==(e=t.font)?void 0:e.textAlign)?a:"center"}),d=p(()=>{var e,a;return null!=(a=null==(e=t.font)?void 0:e.textBaseline)?a:"hanging"}),v=p(()=>t.gap[0]),z=p(()=>t.gap[1]),S=p(()=>v.value/2),k=p(()=>z.value/2),B=p(()=>{var e,a;return null!=(a=null==(e=t.offset)?void 0:e[0])?a:S.value}),j=p(()=>{var e,a;return null!=(a=null==(e=t.offset)?void 0:e[1])?a:k.value}),E=m(null),O=m(),_=g(!1),P=()=>{O.value&&(O.value.remove(),O.value=void 0)},N=(e,a)=>{var n;E.value&&O.value&&(_.value=!0,O.value.setAttribute("style",function(e){return Object.keys(e).map(t=>`${function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}(t)}: ${e[t]};`).join(" ")}(s(u({},(()=>{const e={zIndex:t.zIndex,position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",backgroundRepeat:"repeat"};let a=B.value-S.value,n=j.value-k.value;return a>0&&(e.left=`${a}px`,e.width=`calc(100% - ${a}px)`,a=0),n>0&&(e.top=`${n}px`,e.height=`calc(100% - ${n}px)`,n=0),e.backgroundPosition=`${a}px ${n}px`,e})()),{backgroundImage:`url('${e}')`,backgroundSize:`${Math.floor(a)}px`}))),null==(n=E.value)||n.append(O.value),setTimeout(()=>{_.value=!1}))},C=D(),T=()=>{const e=document.createElement("canvas").getContext("2d"),a=t.image,u=t.content,s=t.rotate;if(e){O.value||(O.value=document.createElement("div"));const p=window.devicePixelRatio||1,[m,g,h]=(e=>{let a=120,n=64,r=0;const{image:l,content:u,width:s,height:f,rotate:d}=t;if(!l&&e.measureText){e.font=`${Number(o.value)}px ${i.value}`;const t=c(u)?u:[u];let l=0,s=0;t.forEach(t=>{const{width:a,fontBoundingBoxAscent:n,fontBoundingBoxDescent:o,actualBoundingBoxAscent:r,actualBoundingBoxDescent:u}=e.measureText(t),i=A(n)?r+u:n+o;a>l&&(l=Math.ceil(a)),i>s&&(s=Math.ceil(i))}),a=l,n=s*t.length+3*(t.length-1);const f=Math.PI/180*Number(d);r=Math.ceil(Math.abs(Math.sin(f)*n)/2),a+=r}return[null!=s?s:a,null!=f?f:n,r]})(e),x=e=>{const[t,a]=C(e||"",s,p,m,g,{color:n.value,fontSize:o.value,fontStyle:l.value,fontWeight:r.value,fontFamily:i.value,textAlign:f.value,textBaseline:d.value},v.value,z.value,h);N(t,a)};if(a){const e=new Image;e.onload=()=>{x(e)},e.onerror=()=>{x(u)},e.crossOrigin="anonymous",e.referrerPolicy="no-referrer",e.src=a}else x(u)}};h(()=>{T()}),x(()=>t,()=>{T()},{deep:!0,flush:"post"}),b(()=>{P()});return y(E,e=>{_.value||e.forEach(e=>{((e,t)=>{let a=!1;return e.removedNodes.length&&t&&(a=Array.from(e.removedNodes).includes(t)),"attributes"===e.type&&e.target===t&&(a=!0),a})(e,O.value)&&(P(),T())})},{attributes:!0,subtree:!0,childList:!0}),(e,t)=>(w(),$("div",{ref_key:"containerRef",ref:E,style:I([a])},[M(e.$slots,"default")],4))}})),[["__file","watermark.vue"]])),X=N(v(s(u({},{name:"ArtWatermark"}),{__name:"index",props:{content:{default:S.systemInfo.name},visible:{type:Boolean,default:!1},fontSize:{default:16},fontColor:{default:"rgba(128, 128, 128, 0.2)"},rotate:{default:-22},gapX:{default:100},gapY:{default:100},offsetX:{default:50},offsetY:{default:50},zIndex:{default:3100}},setup(e){const t=k(),{watermarkVisible:a}=B(t);return(e,t)=>{const n=R;return E(a)?(w(),$("div",{key:0,class:"layout-watermark",style:I({zIndex:e.zIndex})},[O(n,{content:e.content,font:{fontSize:e.fontSize,color:e.fontColor},rotate:e.rotate,gap:[e.gapX,e.gapY],offset:[e.offsetX,e.offsetY]},{default:_(()=>[...t[0]||(t[0]=[P("div",{style:{height:"100vh"}},null,-1)])]),_:1},8,["content","font","rotate","gap","offset"])],4)):j("",!0)}}})),[["__scopeId","data-v-8e0a18b5"]]);export{X as default};
