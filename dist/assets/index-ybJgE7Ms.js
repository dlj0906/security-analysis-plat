var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,n=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&r(e,a,l[a]);if(s)for(var a of s(l))o.call(l,a)&&r(e,a,l[a]);return e},u=(e,s)=>l(e,a(s));import{d as i,w as c,v,s as d,aI as p,a as h,o as f,aK as m,au as y,n as g,e as x,f as w,z as b,C as k,u as j,d1 as C,H as E,h as S,I as T,F as _,D,i as O,l as H,m as A,aD as I,ab as L,aB as K}from"./index-Bt2F3fsx.js";import{E as M}from"./index-CubyMTZl.js";import{E as V}from"./index-Bg32yf_K.js";import{E as P}from"./index-3ycmufMx.js";import{_ as U}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./index-DKc9HdpN.js";import"./aria-DZx3bhbH.js";import"./index-B2c65Y4B.js";import"./index-yYjo3Bby.js";import"./vnode-D7OjJs6e.js";import"./index-BaMjeaFB.js";import"./use-dialog-C_JhW6YK.js";import"./refs-D0ZxbSzV.js";const $={class:"layout-search"},R={class:"result"},q=["onClick","onMouseenter"],z={class:"selected-icon iconfont-sys"},B={class:"history-box"},F={class:"title"},G={class:"history-result"},J=["onClick","onMouseenter"],N=["onClick"],Q={class:"dialog-footer"},W=U(i(u(n({},{name:"ArtGlobalSearch"}),{__name:"index",setup(e){const l=c(),a=v(),{menuList:s}=d(p()),t=h(!1),o=h(""),r=h([]),{searchHistory:i}=d(a),U=h(null),W=h(0),X=h(0),Y=h(),Z=h(!1);f(()=>{m.on("openSearchDialog",he),document.addEventListener("keydown",ee)}),y(()=>{document.removeEventListener("keydown",ee)});const ee=e=>{(navigator.platform.toUpperCase().indexOf("MAC")>=0?e.metaKey:e.ctrlKey)&&"k"===e.key.toLowerCase()&&(e.preventDefault(),t.value=!0,le()),t.value&&("ArrowUp"===e.key?(e.preventDefault(),te()):"ArrowDown"===e.key?(e.preventDefault(),oe()):"Enter"===e.key?(e.preventDefault(),ue()):"Escape"===e.key&&(e.preventDefault(),t.value=!1))},le=()=>{setTimeout(()=>{var e;null==(e=U.value)||e.focus()},100)},ae=e=>{r.value=e?se(s.value,e):[]},se=(e,l)=>{const a=l.toLowerCase(),s=[],t=e=>{var l;if(null==(l=e.meta)?void 0:l.isHide)return;const o=I(e.meta.title).toLowerCase();e.children&&e.children.length>0?e.children.forEach(t):o.includes(a)&&e.path&&s.push(u(n({},e),{children:void 0}))};return e.forEach(t),s},te=()=>{Z.value=!0,o.value?(W.value=(W.value-1+r.value.length)%r.value.length,re()):(X.value=(X.value-1+i.value.length)%i.value.length,ne()),setTimeout(()=>{Z.value=!1},100)},oe=()=>{Z.value=!0,o.value?(W.value=(W.value+1)%r.value.length,re()):(X.value=(X.value+1)%i.value.length,ne()),setTimeout(()=>{Z.value=!1},100)},re=()=>{g(()=>{if(!Y.value||!r.value.length)return;const e=Y.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".result .box");if(!l[W.value])return;const a=l[W.value],s=a.offsetHeight,t=e.scrollTop,o=e.clientHeight,n=a.offsetTop,u=n+s;n<t?Y.value.setScrollTop(n):u>t+o&&Y.value.setScrollTop(u-o)})},ne=()=>{g(()=>{if(!Y.value||!i.value.length)return;const e=Y.value.wrapRef;if(!e)return;const l=e.querySelectorAll(".history-result .box");if(!l[X.value])return;const a=l[X.value],s=a.offsetHeight,t=e.scrollTop,o=e.clientHeight,r=a.offsetTop,n=r+s;r<t?Y.value.setScrollTop(r):n>t+o&&Y.value.setScrollTop(n-o)})},ue=()=>{o.value&&r.value.length?ve(r.value[W.value]):!o.value&&i.value.length&&ve(i.value[X.value])},ie=e=>W.value===e,ce=()=>{W.value=0},ve=e=>{t.value=!1,pe(e),l.push(e.path),o.value="",r.value=[]},de=()=>{Array.isArray(i.value)&&a.setSearchHistory(i.value)},pe=e=>{const l=i.value.findIndex(l=>l.path===e.path);-1!==l?i.value.splice(l,1):i.value.length>=10&&i.value.pop();const a=n({},e);delete a.children,delete a.meta.authList,i.value.unshift(a),de()},he=()=>{t.value=!0,le()},fe=()=>{o.value="",r.value=[],W.value=0,X.value=0};return(e,l)=>{const a=M,s=V,n=P;return w(),x("div",$,[b(n,{modelValue:j(t),"onUpdate:modelValue":l[1]||(l[1]=e=>E(t)?t.value=e:null),width:"600","show-close":!1,"lock-scroll":!1,"modal-class":"search-modal",onClose:fe},{footer:k(()=>[S("div",Q,[S("div",null,[l[3]||(l[3]=S("i",{class:"iconfont-sys"},"",-1)),S("span",null,A(e.$t("search.selectKeydown")),1)]),S("div",null,[l[4]||(l[4]=S("i",{class:"iconfont-sys"},"",-1)),l[5]||(l[5]=S("i",{class:"iconfont-sys"},"",-1)),S("span",null,A(e.$t("search.switchKeydown")),1)]),S("div",null,[l[6]||(l[6]=S("i",{class:"iconfont-sys esc"},[S("p",null,"ESC")],-1)),S("span",null,A(e.$t("search.exitKeydown")),1)])])]),default:k(()=>[b(a,{modelValue:j(o),"onUpdate:modelValue":l[0]||(l[0]=e=>E(o)?o.value=e:null),modelModifiers:{trim:!0},placeholder:e.$t("search.placeholder"),onInput:ae,onBlur:ce,ref_key:"searchInput",ref:U,"prefix-icon":j(C)},{suffix:k(()=>[...l[2]||(l[2]=[S("div",{class:"search-keydown"},[S("i",{class:"iconfont-sys"},"")],-1)])]),_:1},8,["modelValue","placeholder","prefix-icon"]),b(s,{class:"search-scrollbar","max-height":"370px",ref_key:"searchResultScrollbar",ref:Y,always:""},{default:k(()=>[T(S("div",R,[(w(!0),x(_,null,D(j(r),(e,l)=>(w(),x("div",{class:"box",key:l},[S("div",{class:O({highlighted:ie(l)}),onClick:l=>ve(e),onMouseenter:e=>(e=>{!Z.value&&o.value&&(W.value=e)})(l)},[H(A(j(I)(e.meta.title))+" ",1),T(S("i",z,"",512),[[L,ie(l)]])],42,q)]))),128))],512),[[L,j(r).length]]),T(S("div",B,[S("p",F,A(e.$t("search.historyTitle")),1),S("div",G,[(w(!0),x(_,null,D(j(i),(e,l)=>(w(),x("div",{class:O(["box",{highlighted:j(X)===l}]),key:l,onClick:l=>ve(e),onMouseenter:e=>(e=>{Z.value||o.value||(X.value=e)})(l)},[H(A(j(I)(e.meta.title))+" ",1),S("i",{class:"selected-icon iconfont-sys",onClick:K(e=>(e=>{i.value.splice(e,1),de()})(l),["stop"])},"",8,N)],42,J))),128))])],512),[[L,!j(o)&&0===j(r).length&&j(i).length>0]])]),_:1},512)]),_:1},8,["modelValue"])])}}})),[["__scopeId","data-v-7d8e3ad8"]]);export{W as default};
